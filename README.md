# Branch History Predictor Simulator

這是一個基於 C++ 的 **動態分支預測模擬器**。\
程式會模擬 MIPS 組語指令的執行，並利用：

-   **Branch History Table (BHT)**
-   **2-bit 飽和計數器 (2-bit Saturating Counter)**

來預測分支指令是 **Taken (T)** 或 **Not Taken (N)**。

------------------------------------------------------------------------

## 功能特色

-   **指令模擬**\
    支援模擬 `addi`（加法）與 `beq`（分支）指令。

-   **動態預測**\
    每個 Entry 維護 `History` 與 `State`，會依據執行結果即時更新。

-   **2-bit 狀態機**\
    每個 Entry 具有四種狀態：

      狀態   代號   說明
      ------ ------ --------------------
      0      SN     Strongly Not Taken
      1      WN     Weakly Not Taken
      2      WT     Weakly Taken
      3      ST     Strongly Taken

-   **可自訂 Entry 數量**\
    支援 2、4、8、16 個 Entry（需為偶數）。

-   **視覺化輸出**\
    顯示 History、State 更新、預測結果（Correct / Miss）等詳細資訊。

------------------------------------------------------------------------

## 編譯與執行

### 環境需求

-   C++ 編譯器（g++ / clang++ / MinGW）

------------------------------------------------------------------------

### 編譯方式

``` bash
g++ HisPred.cpp -o branch_predictor
```

------------------------------------------------------------------------

### 執行方式

1.  確保 `input.txt` 與執行檔位於相同目錄。\
2.  執行程式：

``` bash
./branch_predictor
```

3.  出現 `entry?` 提示時輸入 Entry 數量（2 / 4 / 8 / 16）。

------------------------------------------------------------------------

## 輸入檔格式（input.txt）

程式會逐行讀取 `input.txt`。\
每行格式包含：

**Address、Instruction、Operands**

### 範例：

    0x0000  addi    R0, R0, 0
    0x0004  addi    R2, R0, 4
    0x000c  Loop:   beq     R1, R2, End
    0x0014  beq     R0, R0, Loop
            End:

### 格式規範

1.  **Input 分為上下兩部分**\
    Loop: 標籤必須出現在下方區塊，且只能有一個 Loop。

2.  **必須包含標籤**

    -   `Loop:` --- 迴圈開始\
    -   `End:` --- 程式結束

3.  **僅支援指令**

    -   `addi`
    -   `beq`

4.  **可插入額外的 addi**\
    在上下兩部分中間可以加入額外的 `addi` 指令。

------------------------------------------------------------------------

## 演算法邏輯

### 預測階段（Prediction）

根據當前 `History`（二進位轉十進位索引）查表：

-   SN、WN（0、1） → 預測 **N**
-   WT、ST（2、3） → 預測 **T**

------------------------------------------------------------------------

### 更新階段（Update）

根據實際 Outcome (`T` 或 `N`) 進行更新：

#### Outcome = T (Taken)

-   **History**：左移一位，右側補 `1`
-   **State**：值 +1（最多到 ST）

#### Outcome = N (Not Taken)

-   **History**：左移一位，右側補 `0`
-   **State**：值 -1（最少到 SN）

------------------------------------------------------------------------

## 輸出範例

每一步會輸出詳細狀態：

    0x000c      entry: 1
    ( 000, SN SN SN SN SN SN SN SN )
    ...
    Outcome: N    Prediction: N >> correct

欄位說明：

-   **entry**：對應的 BHT Entry 索引\
-   **History / State 列表**：例如 `(000, SN SN SN ... )`\
-   **Outcome**：實際執行結果（T/N）\
-   **Prediction**：預測結果\
-   **Result**：correct 或 miss

------------------------------------------------------------------------
